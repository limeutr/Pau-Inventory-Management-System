<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAU Inventory - Wastage Logging</title>
    <link rel="stylesheet" href="wastage-logging.css">
</head>
<body>
    <div class="wastage-container">
        <header class="header">
            <div class="header-content">
                <div class="logo" onclick="goBackToDashboard()" style="cursor: pointer;" title="Return to Dashboard">
                    <h1>PAU Inventory</h1>
                    <span>Wastage Logging</span>
                </div>
                <div class="user-info">
                    <p style="display: none;"><span class="role-badge" id="userRoleBadge">Admin</span></p>
                    <span id="welcomeMessage">Welcome, Admin!</span>
                    <button onclick="goBackToDashboard()" class="back-btn">Back to Dashboard</button>
                    <button id="logoutBtn" class="logout-btn">Logout</button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Quick Stats Section -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card today-wastage">
                        <div class="stat-icon">üóëÔ∏è</div>
                        <div class="stat-info">
                            <h3>Today's Wastage</h3>
                            <p class="stat-number" id="todayWastage">18.5</p>
                            <span class="stat-label">items</span>
                        </div>
                    </div>
                    <div class="stat-card factory-wastage">
                        <div class="stat-icon">üè≠</div>
                        <div class="stat-info">
                            <h3>Factory Wastage</h3>
                            <p class="stat-number" id="factoryWastage">10.5</p>
                            <span class="stat-label">today</span>
                        </div>
                    </div>
                    <div class="stat-card outlet-wastage">
                        <div class="stat-icon">üè™</div>
                        <div class="stat-info">
                            <h3>Outlet Wastage</h3>
                            <p class="stat-number" id="outletWastage">5</p>
                            <span class="stat-label">today</span>
                        </div>
                    </div>
                    <div class="stat-card total-value" id="totalValueCard">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <h3>Total Value Lost</h3>
                            <p class="stat-number" id="totalValueLost">$0.00</p>
                            <span class="stat-label">today</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Wastage Entry Section -->
            <section class="entry-section">
                <div class="section-header">
                    <h2>üóëÔ∏è Log Wastage Entry</h2>
                    <div class="location-tabs">
                        <button class="tab-btn active" data-location="factory" onclick="switchLocation('factory')">
                            üè≠ Factory Wastage
                        </button>
                        <button class="tab-btn" data-location="outlet" onclick="switchLocation('outlet')">
                            üè™ Outlet Wastage
                        </button>
                    </div>
                </div>

                <div class="entry-form-container">
                    <form id="wastageForm" class="wastage-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="itemSelect">Select Item *</label>
                                <select id="itemSelect" name="itemSelect" required>
                                    <option value="">Choose an inventory item...</option>
                                    <option value="INV001">All Purpose Flour (15 kg available)</option>
                                    <option value="INV002">Sugar (22 kg available)</option>
                                    <option value="INV003">Instant Dry Yeast (3.2 kg available)</option>
                                    <option value="INV004">Cooking Oil (8 L available)</option>
                                    <option value="INV005">Salt (10 kg available)</option>
                                    <option value="INV006">Baking Powder (2.5 kg available)</option>
                                    <option value="INV007">Char Siew (3 kg available)</option>
                                    <option value="INV008">Red Bean Paste (5 kg available)</option>
                                    <option value="INV009">Lotus Seed Paste (6 kg available)</option>
                                    <option value="INV010">Custard Filling (4 kg available)</option>
                                    <option value="INV011">Mushroom & Veg Mix (7 kg available)</option>
                                    <option value="INV012">Classic Pau (45 pcs available)</option>
                                    <option value="INV013">Char Siew Pau (32 pcs available)</option>
                                    <option value="INV014">Nai Wong Bao (20 pcs available)</option>
                                    <option value="INV015">Red Bean Pau (22 pcs available)</option>
                                    <option value="INV016">Lotus Bao (20 pcs available)</option>
                                    <option value="INV017">Vegetarian Bao (35 pcs available)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="quantity">Quantity Wasted *</label>
                                <input type="number" id="quantity" name="quantity" min="0.01" step="0.01" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="wasteDate">Date *</label>
                                <input type="date" id="wasteDate" name="wasteDate" required>
                            </div>
                            <div class="form-group">
                                <label for="wasteTime">Time *</label>
                                <input type="time" id="wasteTime" name="wasteTime" required>
                            </div>
                        </div>
                        
                        <div class="form-row" id="outletDetails" style="display: none;">
                            <div class="form-group">
                                <label for="outletLocation">Outlet Location *</label>
                                <select id="outletLocation" name="outletLocation">
                                    <option value="">Select outlet...</option>
                                    <option value="pau_central_outlet">PAU Central Outlet</option>
                                    <option value="downtown_pau_branch">Downtown PAU Branch</option>
                                    <option value="shopping_mall_kiosk">Shopping Mall Kiosk</option>
                                    <option value="airport_food_court">Airport Food Court</option>
                                    <option value="university_campus_branch">University Campus Branch</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="reportedBy">Reported By</label>
                                <input type="text" id="reportedBy" name="reportedBy" placeholder="Staff member who reported">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="wasteReason">Reason for Wastage *</label>
                            <select id="wasteReason" name="wasteReason" required>
                                <option value="">Select reason...</option>
                                <option value="expired">Expired/Past Optimal Freshness</option>
                                <option value="damaged">Damaged During Transport/Handling</option>
                                <option value="contaminated">Contaminated/Foreign Material</option>
                                <option value="quality_issues">Quality Issues (Texture/Taste)</option>
                                <option value="spoiled">Spoiled/Off Odor</option>
                                <option value="production_error">Production Error/Defect</option>
                                <option value="filling_leak">PAU Filling Leakage</option>
                                <option value="overproduction">Overproduction/Unsold</option>
                                <option value="equipment_failure">Equipment Failure Impact</option>
                                <option value="customer_return">Customer Return/Complaint</option>
                                <option value="other">Other (Specify Below)</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="customReasonGroup" style="display: none;">
                            <label for="customReason">Custom Reason *</label>
                            <input type="text" id="customReason" name="customReason" placeholder="Please specify the reason">
                        </div>
                        
                        <div class="form-group">
                            <label for="notes">Additional Notes</label>
                            <textarea id="notes" name="notes" rows="3" placeholder="Optional additional details about the wastage..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" onclick="resetForm()" class="reset-btn">Reset</button>
                            <button type="submit" class="submit-btn" id="submitBtn">Log Factory Wastage</button>
                        </div>
                    </form>
                </div>

                <!-- Current Stock Info -->
                <div id="stockInfo" class="stock-info" style="display: none;">
                    <div class="stock-details">
                        <h4>Current Stock Information</h4>
                        <div class="stock-row">
                            <span>Current Stock:</span>
                            <span id="currentStock">-</span>
                        </div>
                        <div class="stock-row">
                            <span>After Wastage:</span>
                            <span id="afterStock" class="highlight">-</span>
                        </div>
                        <div class="stock-row" id="valueRow" style="display: none;">
                            <span>Estimated Value Lost:</span>
                            <span id="valueLost" class="warning-text">-</span>
                        </div>
                        <div class="stock-row" id="warningRow" style="display: none;">
                            <span class="warning-text">‚ö†Ô∏è Warning:</span>
                            <span id="warningText" class="warning-text">-</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Wastage History -->
            <section class="history-section">
                <div class="section-header">
                    <h2>üìã Wastage History & Analysis</h2>
                    <div class="history-filters">
                        <select id="filterDate" onchange="filterHistory()" class="filter-select">
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="all">All Entries</option>
                        </select>
                        <select id="filterLocation" onchange="filterHistory()" class="filter-select">
                            <option value="">All Locations</option>
                            <option value="factory">Factory Only</option>
                            <option value="outlet">Outlets Only</option>
                        </select>
                        <select id="filterReason" onchange="filterHistory()" class="filter-select">
                            <option value="">All Reasons</option>
                            <option value="expired">Expired</option>
                            <option value="damaged">Damaged</option>
                            <option value="contaminated">Contaminated</option>
                            <option value="quality_issues">Quality Issues</option>
                            <option value="spoiled">Spoiled</option>
                        </select>
                    </div>
                </div>

                <div class="history-table-container">
                    <table class="history-table" id="historyTable">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Location</th>
                                <th>Item</th>
                                <th>Quantity</th>
                                <th>Reason</th>
                                <th>Value Lost</th>
                                <th>Logged By</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr class="history-row factory">
                                <td>2025-07-25 09:30:15</td>
                                <td>Factory</td>
                                <td>Classic Pau</td>
                                <td>8 pcs</td>
                                <td><span class="reason-badge expired">Expired</span></td>
                                <td><span class="value-lost">$12.00</span></td>
                                <td>Sarah Chen</td>
                                <td>Left overnight, past optimal freshness for sale</td>
                            </tr>
                            <tr class="history-row outlet">
                                <td>2025-07-25 08:45:22</td>
                                <td>Shopping Mall Kiosk</td>
                                <td>Char Siew Pau</td>
                                <td>5 pcs</td>
                                <td><span class="reason-badge damaged">Damaged</span></td>
                                <td><span class="value-lost">$10.00</span></td>
                                <td>Mike Rodriguez</td>
                                <td>Filling leaked during transport - customer complaint</td>
                            </tr>
                            <tr class="history-row factory">
                                <td>2025-07-25 07:15:33</td>
                                <td>Factory</td>
                                <td>All Purpose Flour</td>
                                <td>2.5 kg</td>
                                <td><span class="reason-badge contaminated">Contaminated</span></td>
                                <td><span class="value-lost">$8.75</span></td>
                                <td>James Liu</td>
                                <td>Small insects found in storage bag - entire bag discarded</td>
                            </tr>
                            <tr class="history-row outlet">
                                <td>2025-07-24 19:20:45</td>
                                <td>PAU Central Outlet</td>
                                <td>Nai Wong Bao</td>
                                <td>12 pcs</td>
                                <td><span class="reason-badge overproduction">Overproduction</span></td>
                                <td><span class="value-lost">$18.00</span></td>
                                <td>Lisa Wang</td>
                                <td>End of day surplus - unable to sell before closing</td>
                            </tr>
                            <tr class="history-row factory">
                                <td>2025-07-24 16:55:18</td>
                                <td>Factory</td>
                                <td>Red Bean Paste</td>
                                <td>1.2 kg</td>
                                <td><span class="reason-badge production_error">Production Error</span></td>
                                <td><span class="value-lost">$7.20</span></td>
                                <td>David Kim</td>
                                <td>Oversweetened batch - texture not meeting quality standards</td>
                            </tr>
                            <tr class="history-row outlet">
                                <td>2025-07-24 15:30:42</td>
                                <td><span class="location-badge outlet">üè™ Airport Food Court</span></td>
                                <td>Lotus Bao</td>
                                <td>6 pcs</td>
                                <td><span class="reason-badge quality_issues">Quality Issues</span></td>
                                <td><span class="value-lost">$12.00</span></td>
                                <td>Emily Zhang</td>
                                <td>Filling too dry - customer returned after purchase</td>
                            </tr>
                            <tr class="history-row factory">
                                <td>2025-07-24 14:10:55</td>
                                <td>Factory</td>
                                <td>Char Siew</td>
                                <td>0.8 kg</td>
                                <td><span class="reason-badge spoiled">Spoiled</span></td>
                                <td><span class="value-lost">$9.60</span></td>
                                <td>Tom Foster</td>
                                <td>Off smell detected during quality check - safety disposal</td>
                            </tr>
                            <tr class="history-row outlet">
                                <td>2025-07-24 13:25:33</td>
                                <td>University Campus Branch</td>
                                <td>Vegetarian Bao</td>
                                <td>4 pcs</td>
                                <td><span class="reason-badge filling_leak">Filling Leakage</span></td>
                                <td><span class="value-lost">$6.00</span></td>
                                <td>Alex Thompson</td>
                                <td>Wrapping issue during steaming - filling leaked out</td>
                            </tr>
                            <tr class="history-row factory">
                                <td>2025-07-24 11:40:12</td>
                                <td>Factory</td>
                                <td>Sugar</td>
                                <td>1.5 kg</td>
                                <td><span class="reason-badge equipment_failure">Equipment Failure</span></td>
                                <td><span class="value-lost">$4.50</span></td>
                                <td>Maria Santos</td>
                                <td>Mixer malfunction caused sugar to clump and burn</td>
                            </tr>
                            <tr class="history-row outlet">
                                <td>2025-07-23 18:45:28</td>
                                <td>Downtown PAU Branch</td>
                                <td>Classic Pau</td>
                                <td>15 pcs</td>
                                <td><span class="reason-badge expired">Expired</span></td>
                                <td><span class="value-lost">$22.50</span></td>
                                <td>Robert Lee</td>
                                <td>End of shelf life - standard disposal protocol</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirm Wastage Entry</h3>
            </div>
            <div class="modal-body">
                <div class="confirmation-details">
                    <h4>Wastage Details:</h4>
                    <div id="confirmationText"></div>
                    <div class="stock-impact">
                        <h4>Impact:</h4>
                        <div id="stockImpactText"></div>
                    </div>
                    <div class="warning-notice">
                        <p><strong>‚ö†Ô∏è Important:</strong> This action will permanently reduce inventory levels and cannot be undone.</p>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button onclick="closeConfirmModal()" class="cancel-btn">Cancel</button>
                <button onclick="confirmWastage()" class="confirm-btn">Confirm Wastage</button>
            </div>
        </div>
    </div>

    <script src="wastage-logging.js"></script>
</body>
</html>
